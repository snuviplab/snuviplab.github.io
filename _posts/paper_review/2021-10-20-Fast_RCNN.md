---
layout: post
title: "Fast R-CNN (ICCV 2015)"
modified:
categories: paper_review
excerpt:
tags: [Object Detection]
image:
 feature:
date: 2021-10-20T03:05:00-00:00
comments : true
---
# Fast R-CNN (ICCV 2015)
    
## Main Idea

- R-CNN : multi-stage(proposal, detection, bbox) â‡’ Fast R-CNN : single-stage
    - using multi-task learning
- ì „ì²´ ì´ë¯¸ì§€ë¥¼ CNNì— ë„£ìŒ (1 CNN on the entire image)
    - ì´ì „ì—ëŠ” Selective Searchë¡œ ë½‘ì•„ë‚¸ ëª¨ë“  region proposal í›„ë³´ë“¤ì„ CNN ëª¨ë¸ì— ë„£ì—ˆìŒ. (1 CNN per region)
    - **2000 â†’ 1**

## Fast R-CNN architecture

![/images/Fast-RCNN/á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º_2021-07-27_á„‹á…©á„’á…®_3.26.36.png](/images/Fast-RCNN/á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º_2021-07-27_á„‹á…©á„’á…®_3.26.36.png)

#### Process

1. ì „ì²´ ì´ë¯¸ì§€ë¥¼ CNN modelì— í†µê³¼ì‹œì¼œ Feature map ì¶”ì¶œ
2. Selective Searchë¥¼ í†µí•´ ì°¾ì•„ë‚¸ RoIë“¤ì„ í”¼ì³ë§µì— projectionì‹œí‚¤ê³ , ê°ê°ì˜ RoIì— ëŒ€í•´ì„œ RoI poolingì„ ì§„í–‰ â‡’ ê³ ì •ëœ í¬ê¸°ì˜ feature vector ì¶”ì¶œ
3. feature vectorë¥¼ 2ê°œì˜ ë¸Œëœì¹˜ë¡œ ë‚˜ëˆ  Fully Conneted layerì— í†µê³¼
    1. [1ë²ˆ ë¸Œëœì¹˜] classification : softmaxë¥¼ í†µê³¼í•˜ì—¬ í•´ë‹¹ RoIê°€ ì–´ë–¤ ì˜¤ë¸Œì íŠ¸ì¸ì§€ ë¶„ë¥˜ 
    ğŸ’¥ output : softmax value â†’ class
    2. [2ë²ˆ ë¸Œëœì¹˜] bbox regression : regressionì„ í†µí•´ selective searchë¡œ ì°¾ì€ ë°”ìš´ë”© ë°•ìŠ¤ ì¡°ì •â‡’ ì˜¬ë°”ë¥¸ bbox ì¢Œí‘œ ì˜ˆì¸¡ 
    ğŸ’¥ output : bounding-box regression offsets

---

### (1) Deep ConvNet & RoI Projection

![/images/Fast-RCNN/Untitled.png](/images/Fast-RCNN/Untitled.png)

[https://nuggy875.tistory.com/33](https://nuggy875.tistory.com/33)

![/images/Fast-RCNN/á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º_2021-07-27_á„‹á…©á„’á…®_4.03.57.png](/images/Fast-RCNN/á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º_2021-07-27_á„‹á…©á„’á…®_4.03.57.png)

> R-CNN ë°©ì‹ vs. Fast R-CNN ë°©ì‹

- R-CNN â†’ Selective Searchë¡œ ë½‘ì•„ë‚¸ Region Proposal í›„ë³´ë“¤ì„ ëª¨ë‘ CNNì— ë„£ì–´ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¼
- Fast R-CNN â†’ 1 CNN on the entire image
    - Selective Searchë¥¼ í†µí•´ Region Proposalì€ í•¨. R-CNNê³¼ ë‹¤ë¥´ê²Œ ë½‘ì•„ë‚¸ ì˜ì—­ì„ ê·¸ëŒ€ë¡œ ê°€ì§€ê³  ìˆëŠ” ì±„ë¡œ ì „ì²´ ì´ë¯¸ì§€ë¥¼ CNN ëª¨ë¸ì— ë„£ìŒ
    - ğŸ³ CNN modelì˜ ouputì¸ Feature Mapì— RoI projection
        
        > ğŸ” RoI Projection : ì¸í’‹ ì‚¬ì´ì¦ˆì™€ í”¼ì³ë§µ ì‚¬ì´ì¦ˆê°€ ë™ì¼í•˜ë‹¤ë©´ ì•ì„œ êµ¬í•œ RoIë“¤ì˜ ì¢Œí‘œë¥¼ í”¼ì³ë§µì— ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ë©´ ë˜ì§€ë§Œ, ë§Œì•½ ë‹¤ë¥´ë‹¤ë©´ ê° RoIë“¤ì€ ëª¨ë¸ì„ í†µê³¼í•˜ì—¬ ì¤„ì–´ë“  í¬ê¸°ì˜ ë¹„ìœ¨ì„ ë”°ì ¸ì„œ ì¢Œí‘œë¥¼ ë³€ê²½ì‹œí‚´.

### (2) RoI Pooling

![/images/Fast-RCNN/Untitled\1.png](/images/Fast-RCNN/Untitled 1.png)

> RoIë“¤ì€ input ì´ë¯¸ì§€ì—ì„œ Selective Searchë¥¼ í†µí•´ ì°¾ì€ ê²ƒì„ feature mapì— ì ìš©í•œ ê²ƒì´ë‹¤.
> 
- Selective Searchë¡œ í†µí•´ êµ¬í•œ RoI ì˜ì—­ì„ ê°ê¸° ë‹¤ë¥¸ í¬ê¸°ë¥¼ ê°€ì§€ê³  ìˆìŒ
- FC : ê³ ì •ëœ í¬ê¸°ì˜ ì¸í’‹ í•„ìš”
- â›³ï¸ GOAL:  ë‹¤ì–‘í•œ í¬ê¸°ì˜ RoI â†’ ê³ ì •ëœ í¬ê¸°ë¡œ ì¶•ì†Œ
    - **ì´ RoIëŠ” ì–´ëŠ ì‹œê¸°ì˜ í”¼ì³ë§µì„ ì‚¬ìš©?**

![/images/Fast-RCNN/Untitled.png](/images/Fast-RCNN/Untitled 2.png)

8x8 input feature mapì—ì„œ Selective Searchë¡œ ë½‘ì€ 7x5ì§œë¦¬ region proposal(ì•„ë˜)

![/images/Fast-RCNN/Untitled 3.png](/images/Fast-RCNN/Untitled 3.png)

2x2ë¡œ ë§Œë“¤ê¸°ìœ„í•´ Stride(7/2=**3**, 5/2=**2**)ë¡œ Pooling êµ¬ì—­ì„ ì •í•˜ê³  Max Pooling â†’ output : 2x2 (ë…¼ë¬¸ì—ì„œëŠ” 7x7 ì‚¬ìš©)

![https://deepsense.ai/wp-content/uploads/2017/02/roi_pooling-1.gif.pagespeed.ce.5V5mycIRNu.gif](https://deepsense.ai/wp-content/uploads/2017/02/roi_pooling-1.gif.pagespeed.ce.5V5mycIRNu.gif)

[https://deepsense.ai/region-of-interest-pooling-explained/](https://deepsense.ai/region-of-interest-pooling-explained/)

- RoIì— ë‹¤ ì ìš© â‡’ ëª¨ë‘ ë‹¤ ê°™ì€ í¬ê¸°ì˜ ë²¡í„° â†’ FC layer

### Classification & Bounding box Regression

![/images/Fast-RCNN/Untitled 4.png](/images/Fast-RCNN/Untitled 4.png)

```markdown
**(FC layer)**
ğŸ’¥ input : ê³ ì •ëœ í¬ê¸°ì˜ feature vector
ğŸ’¥ output1 : softmax value(classification)
ğŸ’¥ output2 : bounding-box regression offsets

=========
bbox regression => K + 1ê°œ í´ë˜ìŠ¤ì— ëŒ€í•´ì„œ ê°ê° x, y, w, h ê°’ì„ **ì¡°ì •**í•˜ëŠ” t_uë¥¼ ë¦¬í„´
==> ì¦‰, ì´ RoIê°€ ì‚¬ëŒì¼ ê²½ìš° ë°•ìŠ¤ë¥¼ ì´ë ‡ê²Œ ì¡°ì ˆí•´ë¼, ê³ ì–‘ì´ì¼ ê²½ìš° ì´ë ‡ê²Œ ì¡°ì ˆí•´ë¼ ë¼ëŠ” ì˜ë¯¸

```

#### Multi-task Loss

- $ L(p,u,t^u,v) = L_{cls}(p,u) + \lambda[u\ge1]L_{loc}(t^u,v) $
    - classification loss + bbox regression loss â‡’ multi-task loss
    $p=(p_0,...,p_K)$ : softmaxë¥¼ í†µí•´ ì–»ì–´ë‚¸ `K+1(K-classes + None)` ê°œì˜ í™•ë¥ ê°’
        
        $u$ : í•´ë‹¹ RoIì˜ G.T í´ë˜ìŠ¤ ê°’
        
        > [uâ‰¥1]ì€ G.T labelì´ Background (u=0)ì´ë©´ Lloc term ë‚ ë¦¼.<br/>
            ğŸ¤·ğŸ»? â‡’ Bounding Boxë¥¼ ì¹˜ê³ ì í•˜ëŠ” ëŒ€ìƒì€ Backgroundê°€ ì•„ë‹Œ Objectì´ê¸° ë•Œë¬¸ì´ë‹¤.
        
        $t^u=(t_x^u,t_y^u, t_w^u,t_h^u)$ : bbox regression offset (ì˜ˆì¸¡í•œ bbox ì¢Œí‘œë¥¼ ì¡°ì •í•˜ëŠ” ê°’)
        
        $v$ : ground truth bbox ì¡°ì ˆ ê°’
        
    - $L_{cls}(p,u) = -\log p_u$
    - $L_{loc}(t^u,v) = \sum_{i\in{x,y,w,h}} smooth_{L_1}(t_i^u-v_i)$
        
        ![/images/Fast-RCNN/á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º_2021-07-27_á„‹á…©á„’á…®_4.45.17.png](/images/Fast-RCNN/á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º_2021-07-27_á„‹á…©á„’á…®_4.45.17.png)
        

## Experiments

1. State-of-the-art mAP on VOC07, 2010, and 2012
2. Fast training and testing compared to R-CNN, SPPnet
3. Fine-tuning conv layers in VGG16 improves mAP

![/images/Fast-RCNN/á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º_2021-07-27_á„‹á…©á„’á…®_5.13.14.png](/images/Fast-RCNN/á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º_2021-07-27_á„‹á…©á„’á…®_5.13.14.png)

- Discussion : **ì™œ ì„±ëŠ¥ì´ ë” ì¢‹ì•„ì¡ŒëŠ”ê°€? RoI í’€ë§ì˜ íš¨ê³¼ì¸ê°€ ì •ë§?**

## Conclusion

1. ë›°ì–´ë‚œ ì„±ëŠ¥
2. End-to-End Single Stage Training
3. No disk storage is needed
    - R-CNN â†’ CNNì—ì„œ ë‚˜ì˜¨ í”¼ì³ë§µì„ ë””ìŠ¤í¬ì— ì €ì¥í•´ë‘ê³  classification, bbox regressioní•  ë•Œ ë¶ˆëŸ¬ì˜´
